---
id: phpunit
title: 'PHPUnit: Les tests unitaires avec PHPUnit'
description: Apprendre √† √©crire des tests unitaires avec PHPUnit
slug: /phpunit
---

## Introduction

Attendez‚Ä¶ quelqu'un a ENCORE construit un parc de dinosaures sans AUCUN test !?!? J'ai d√©j√† vu ce film, et c'est √† nous de jouer : ajouter une suite compl√®te de tests avant que les dinos ne viennent pour nous‚Ä¶

Plus s√©rieusement : les tests sont g√©niaux. Ce n'est pas seulement un outil pour √©viter les bugs, c'est aussi une philosophie de d√©veloppement qui peut vous aider √† √©crire du code plus cibl√©, centr√© sur ce que vous voulez r√©ellement construire.

Dans ce tutoriel, vous allez atteindre le niveau super-h√©ros des tests unitaires, avec notamment :

- Les bases des tests unitaires
- Le d√©veloppement dirig√© par les tests (TDD) : comment le faire, et quand le faire !
- L'utilisation de Fixtures pour ex√©cuter plusieurs fois les tests avec diff√©rentes entr√©es
- Les mocks et doubles de test ! Cr√©er des mocks avec PHPUnit
- L'ex√©cutable PHPUnit et sa configuration
- Tester les exceptions

## Initiation √† PHPUnit

### Installation via Composer (recommand√©)

PHPUnit s'installe le plus souvent via Composer comme d√©pendance de d√©veloppement :

```bash
composer require --dev phpunit/phpunit
```

Cela permet √† PHPUnit d'√™tre int√©gr√© √† votre projet, versionn√©, et ex√©cut√© depuis le r√©pertoire `vendor`.

### V√©rification de l'installation

Une fois install√©, vous pouvez v√©rifier que tout fonctionne :

```bash
./vendor/bin/phpunit --version
```

Si tout est pr√™t, vous verrez s'afficher une version de type `PHPUnit x.y.z`.

:::info
üí° Pour simplifier, vous pouvez cr√©er un alias dans votre fichier composer.json :
```json
"scripts": {
    "test": "vendor/bin/phpunit"
}
```

Et ex√©cuter vos tests simplement avec :

```bash
composer test
```
:::

### Structure de base d'un test PHPUnit 

Un test unitaire est une classe qui h√©rite de `PHPUnit\Framework\TestCase`. Chaque m√©thode publique qui commence par `test` sera consid√©r√©e comme un test par PHPUnit.

#### Exemple minimal
Cr√©eons un fichier `Calculator.php` :

```php
<?php

namespace App;

class Calculator
{
    public function add(int $a, int $b): int
    {
        return $a + $b;
    }
}
```

Cr√©ons ensuite un fichier de test `tests/CalculatorTest.php` :

```php
<?php

use PHPUnit\Framework\TestCase;
use App\Calculator;

class CalculatorTest extends TestCase
{
    public function testAddReturnsTheCorrectSum(): void
    {
        $calculator = new Calculator();
        $this->assertEquals(4, $calculator->add(2, 2));
    }
}
```

Pour ex√©cuter le test :

```bash
./vendor/bin/phpunit tests/CalculatorTest.php
```

#### R√©sultat attendu

```bash
OK (1 test, 1 assertion)
```

Si le test √©choue, vous verrez un message explicite indiquant l'√©chec.

### Les assertions les plus courantes

PHPUnit propose une grande vari√©t√© d'assertions :

- `assertEquals($expected, $actual)`: V√©rifie que les deux valeurs sont √©gales.
- `assertNotEquals($expected, $actual)`: V√©rifie que les deux valeurs ne sont pas √©gales.
- `assertTrue($condition)`: V√©rifie que la condition est vraie.
- `assertFalse($condition)`: V√©rifie que la condition est fausse.
- `assertNull($actual)`: V√©rifie que la valeur est nulle.
- `assertCount($expectedCount, $haystack)`: V√©rifie que le nombre d'√©l√©ments dans `$haystack` est √©gal √† `$expectedCount`.
- `assertInstanceOf($expectedClass, $actual)`: V√©rifie que `$actual` est une instance de `$expectedClass`.
- `assertContains($needle, $haystack)`: V√©rifie que `$needle` est pr√©sent dans `$haystack`.

### Organisation des tests dans Symfony

Dans un projet Symfony, les tests sont g√©n√©ralement situ√©s dans le dossier `tests/`. Par convention :

- Les tests fonctionnels sont dans `tests/Functional/`
- Les tests unitaires sont dans `tests/Unit/`
- Les tests d'int√©gration sont dans `tests/Integration/`

Symfony fournit un environnement de test isol√© par d√©faut (`APP_ENV=test`) et des outils comme le `KernelTestCase` pour tester avec le container de service.
